import{bn as ee,e as te,dW as se,dX as E,M as G,aY as ne,b0 as ie,cE as oe,dY as ae,dZ as le,d_ as j,W as F,b as V,aj as re,d as ce,ae as de,i as D,ap as $,a as fe,Q as he,Y as q,d$ as ue,e0 as me,f as ge,bW as pe}from"./index-_yd-8GWv.js";import{f as w,w as x}from"./page-DEJffvkR.js";function Ee(n,e){return n=ee(n),e?n.forEach(t=>t.setAttribute("disabled","true")):n.forEach(t=>t.removeAttribute("disabled")),()=>Ee(n,!e)}function Q(n,e=!1,t=!0){if(!(te&&(!e||document.activeElement.tagName!=="INPUT"&&!document.activeElement.isContentEditable)))if(t&&n.focus(),n instanceof HTMLInputElement){const s=n.value.length;n.selectionStart=s,n.selectionEnd=s}else{const s=document.createRange();s.selectNodeContents(n),s.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(s)}}window.placeCaretAtEnd=Q;function ye(n){return Array.from(n.childNodes).map(e=>e.nodeType===e.TEXT_NODE?se(e.textContent):e.outerHTML).join("")}function Ne(n,e){return n.closest(`[${e}]`)}function ve(n,e){return n.closest(e)}function Y(n,e){const t=document.getSelection(),s=t.focusNode,i=t.focusOffset;return!w(s,n)&&s!==n?{selection:t}:{...be(n,s,i),selection:t}}function be(n,e,t){if(e===n){const s=n.childNodes,i=s.length;i&&t>=i?(e=s[i-1],t=(e.textContent||e.alt||"").length):(e=s[t],t=0)}return{node:e,offset:t}}const Ce=new Set(["messageEntityBold","messageEntityItalic","messageEntityCode","messageEntityPre","messageEntityUnderline","messageEntityStrike","messageEntityBlockquote","messageEntitySpoiler"]);function Se(n){for(let e=0;e<n.length;++e){const t=n[e];let s=-1;do if(s=n.findIndex((i,a)=>Ce.has(i._)&&a!==e&&i._===t._&&i.offset-t.length===t.offset),s!==-1){const i=n[s];t.length+=i.length,n.splice(s,1)}while(s!==-1)}}function K(n){n.sort((e,t)=>e.offset-t.offset||t.length-e.length)}const O={bold:{match:'[style*="bold"], [style*="font-weight: 700"], [style*="font-weight: 600"], [style*="font-weight:700"], [style*="font-weight:600"], b, strong',entityName:"messageEntityBold"},underline:{match:'[style*="underline"], u, ins',entityName:"messageEntityUnderline"},italic:{match:'[style*="italic"], i, em',entityName:"messageEntityItalic"},monospace:{match:'[style*="monospace"], [face*="monospace"], pre',entityName:"messageEntityCode"},strikethrough:{match:'[style*="line-through"], [style*="strikethrough"], strike, del, s',entityName:"messageEntityStrike"},link:{match:"A:not(.follow)",entityName:"messageEntityTextUrl"},mentionName:{match:"A.follow",entityName:"messageEntityMentionName"},spoiler:{match:'[style*="spoiler"]',entityName:"messageEntitySpoiler"},quote:{match:'[style*="quote"], .quote',entityName:"messageEntityBlockquote"}},Te='[style*="table-cell"], th, td',xe=new Set(["DIV","P","BR","LI","SECTION","H6","H5","H4","H3","H2","H1","TR","OL","UL","BLOCKQUOTE"]),Le=new RegExp(E,"g"),S="";function U(n,e,t,s){const i=n.parentElement;for(const a in O){const o=O[a],l=i.closest(o.match+', [contenteditable="true"]');if(l?.getAttribute("contenteditable")!==null)continue;let f;o.entityName==="messageEntityCode"&&(f=i.closest("[data-language]"))?t.push({_:"messageEntityPre",language:f.dataset.language||"",offset:s.offset,length:e.length}):o.entityName==="messageEntityTextUrl"?t.push({_:o.entityName,url:l.href,offset:s.offset,length:e.length}):o.entityName==="messageEntityMentionName"?t.push({_:o.entityName,offset:s.offset,length:e.length,user_id:l.dataset.follow.toUserId()}):o.entityName==="messageEntityBlockquote"?t.push({_:o.entityName,pFlags:{collapsed:!!l.dataset.collapsed||void 0},offset:s.offset,length:e.length}):t.push({_:o.entityName,offset:s.offset,length:e.length})}}function H(n){const{length:e}=n;return!e||n[e-1]===S&&e===S.length}function A(n,e,t,s,i,a,o={offset:0}){if(n.nodeType===n.TEXT_NODE){let d=n.nodeValue;d=d.replace(Le,""),d?s===n?t.push(d.substr(0,i)+S+d.substr(i)):t.push(d):s===n&&t.push(S),a&&d.length&&n.parentNode&&U(n,d,a,o),o.offset+=d.length;return}if(n.nodeType!==n.ELEMENT_NODE)return;const l=()=>{e.push(t.join("")),t.length=0,++o.offset},f=s===n,u=n.matches(O.quote.match),r=xe.has(n.tagName)||u;if(r&&(t.length&&t[t.length-1].slice(-1)!==`
`||n.tagName==="BR"))l();else{const d=n.dataset.stickerEmoji||n.alt,g=n.dataset.stickerEmoji;d&&a&&U(n,d,a,o),g&&a&&a.push({_:"messageEntityCustomEmoji",document_id:n.dataset.docId,offset:o.offset,length:d.length}),d&&(t.push(d),o.offset+=d.length)}f&&!i&&t.push(S);const m=n.matches(Te),h=a?.length;let p=!0;u&&(o.isInQuote=!0);let c=n.firstChild;for(;c;)A(c,e,t,s,i,a,o),c=c.nextSibling,H(t)||(p=!1);if(u){const d=t[t.length-1];d?.endsWith(`
`)&&(t[t.length-1]=d.slice(0,-1),o.offset-=1),o.isInQuote=!1}if(p&&n.textContent?.replace(/[\r\n]/g,"")&&(p=!1),f&&i&&t.push(S),m&&n.nextSibling&&!H(t)&&(t.push(" "),++o.offset,h!==void 0))for(let d=h,g=a.length;d<g;++d)++a[d].length;r&&!p&&l(),!p&&n.tagName==="P"&&n.nextSibling&&(e.push(""),++o.offset)}function z(n){const e=window.getSelection();let t,s;if(e?.rangeCount){const i=e.getRangeAt(0),a=i.startOffset;if(i.startContainer&&i.startContainer==i.endContainer&&a==i.endOffset){const o=a-1,l=n.childNodes;if(i.startContainer===n&&l[o]){t=l[o],s=0;for(let f=0;f<i.endOffset;++f){const u=l[f],r=u.nodeValue||u.alt;r&&(s+=r.length)}}else t=i.startContainer,s=a}}return{node:t,offset:s}}function L(n,e=!0,t=!0){const s=[],i=[],{node:a,offset:o}=!(n instanceof DocumentFragment)&&t&&z(n),l=e?[]:void 0,f={offset:0};if(n instanceof DocumentFragment){let m=n.firstChild;for(;m;)A(m,s,i,a,o,l,f),m=m.nextSibling}else A(n,s,i,a,o,l,f);i.length&&s.push(i.join(""));let u=s.join(`
`);const r=u.indexOf(S);return r!==-1&&(u=u.substr(0,r)+u.substr(r+1)),u=u.replace(/\u00A0/g," "),l?.length&&(Se(l),K(l)),{value:u,entities:l,caretPos:r}}G.getCaretPos=z;G.getRichValueWithCaret=L;function we(n,e){let t;if(n.isContentEditable||n.tagName!=="INPUT"){if(n.querySelector(".emoji, .custom-emoji, .custom-emoji-placeholder"))return!1;t=n.textContent}else t=n.value;return e?!t:!t.trim()}class Oe{constructor(){this.listeners=new Set}add(e){return(t,s,i)=>{const a={element:e,event:t,callback:s,options:i};return this.addManual(a),a}}addManual(e){e.element.addEventListener(e.event,e.callback,e.options),e.options?.once&&(e.onceCallback=()=>{this.remove(e),e.onceFired=!0},e.element.addEventListener(e.event,e.onceCallback,e.options)),this.listeners.add(e)}remove(e){e.onceFired||(e.element.removeEventListener(e.event,e.callback,e.options),e.onceCallback&&e.element.removeEventListener(e.event,e.onceCallback,e.options)),this.listeners.delete(e)}removeManual(e,t,s,i){let a;for(const o of this.listeners)if(o.element===e&&o.event===t&&o.callback===s&&o.options===i){a=o;break}a&&this.remove(a)}removeAll(){this.listeners.forEach(e=>{this.remove(e)})}}function k(n,e,t,s){let i;if(n===t)i=e-s;else if(n.parentElement===t.parentElement)i=x(n,!0)-x(t,!0);else{const a=[];let o=n.parentElement;do a.push(o);while(o=o.parentElement);o=t.parentElement;do if(a.includes(o))break;while(o=o.parentElement);const l=o;n=w(n,l),t=w(t,l),i=x(n,!0)-x(t,!0)}return ne(i,-1,1)}window.compareNodes=k;const W=new RegExp(`[^${E}]`);class _{constructor(){this.saveSelectionOnChange=e=>{const t=document.activeElement;this.saveRangeForElement(t)},this.onFocusOut=e=>{this.lastNode=this.lastOffset=void 0},this.onSelectionChange=e=>{const{input:t}=this;if(!t){this.setSelectionClassName(document.getSelection());return}let s=this.getCaretPosN();do{const{node:i,offset:a,selection:o,move:l}=s;if(i?.nodeValue!==E||!this.lastNode)break;const u=k(i,a,this.lastNode,this.lastOffset)<0;u!==void 0&&(o.isCollapsed?this.superMove(t,s,u,!0):o.modify(o.isCollapsed?"move":"extend",u?"backward":"forward","character")),this.log("selectionchange",i,a,this.lastNode,this.lastOffset,i===this.lastNode,x(this.getFiller(i)),x(this.getFiller(this.lastNode)),u,o,document.getSelection(),document.getSelection().getRangeAt(0),i?.parentNode,this.lastNode?.parentNode),s=this.getCaretPosN(),this.lastNode=i,this.lastOffset=a;break}while(!0);this.lastNode=this.lastOffset=void 0,this.setSelectionClassName(s.selection,t)},this.onBeforeInput=e=>{const{input:t,log:s}=this;if(!t)return;const i=this.addInputCallback.bind(this,t),a=this.getCaretPosN();let{node:o,offset:l,selection:f,move:u}=a;if(s("beforeinput",e,o,l,f,a),this.lastNode=this.lastOffset=void 0,e.inputType.startsWith("delete")){if(i(()=>{this.processEmptiedFillers(t),this.removeExtraBOMs(t),this.fixInsertedLineBreaks(t)}),o?.nodeValue===E&&f.isCollapsed&&e.inputType.includes("deleteContent")){const r=e.inputType.includes("Backward"),m=l===E.length&&r||!l&&!r;this.superMove(t,a,r,m)}}else if(e.inputType.startsWith("insert")){if(o?.classList?.contains("input-something")){o=o.previousSibling.firstChild;const r=f.getRangeAt(0);r.setStart(o,0),r.setEnd(o,0),r.collapse(!0);const m=this.getCaretPosN();o=m.node,f=m.selection,l=m.offset}if(o&&o.textContent===E&&l===E.length){f.modify("move","backward","character");const r=this.getCaretPosN();o=r.node,f=r.selection,l=r.offset}e.inputType;{o&&o.nodeType===o.ELEMENT_NODE&&(o=o.firstChild,s.warn("fixing focus on span"));const r=o?.nodeValue===E;if(s("inserting line break",r,o,`"${o?.nodeValue}"`,o?.parentElement?Array.from(o.parentElement.childNodes).slice():[]),r){const m=o.parentElement;m.classList.replace("input-filler","input-filler-text"),m.childNodes.length,i(()=>{m.childNodes.length>1?(s("inserting line break, remove"),o=Array.from(m.childNodes).find(p=>p.nodeValue===E),m.t=o):o.nodeValue!==E&&(s("inserting line break, deleteData"),o.deleteData(o.nodeValue.indexOf(E),E.length)),this.fixInsertedLineBreaks(t)})}else e.inputType==="insertLineBreak"&&i(()=>{this.fixInsertedLineBreaks(t)})}return}else e.inputType==="historyUndo"?i(()=>{this.processFilledFillers(t),this.processEmptiedFillers(t),this.removeExtraBOMs(t),this.removeEmptyTextNodes(t),this.fixBuggedCaret()}):e.inputType==="historyRedo"&&i(()=>{this.processFilledFillers(t),this.processEmptiedFillers(t),t.querySelectorAll(".input-something:not([contenteditable])").forEach(r=>{r.contentEditable="false"}),this.removeExtraBOMs(t),this.fixBuggedCaret()})},this.onKeyDown=e=>{const t=e.key;if(t==="ArrowDown"||t==="ArrowUp")this.lastNode=this.lastOffset=void 0;else{const{node:s,offset:i}=this.getCaretPosN();this.lastNode=s,this.lastOffset=i,this.lastNode===this.input&&(this.lastNode=this.lastOffset=void 0)}this.log("keydown",this.lastNode,this.lastNode?.parentNode,this.lastOffset,this.getCaretPosN(),e)},this.log=ie("RICH-INPUT"),this.listenerSetter=new Oe,this.savedRanges=new WeakMap,this.listenerSetter.add(document)("selectionchange",this.saveSelectionOnChange)}get input(){const e=document.getSelection(),{anchorNode:t}=e;if(t)return(t.closest?t:t.parentElement).closest('[contenteditable="true"]')}saveRangeForElement(e){e&&(e.isContentEditable||e.tagName==="INPUT")&&document.getSelection().rangeCount&&this.savedRanges.set(e,document.getSelection().getRangeAt(0))}findPreviousSmthIndex(e,t,s){const i=Array.from(s??e.querySelectorAll(".input-something")),a=i.findIndex(o=>k(o,0,t,0)>=0);return a===-1?i.length-1:Math.max(0,a-1)}superMove(e,t,s,i){const{node:a,offset:o,move:l}=t,f=e.querySelectorAll(".input-something"),u=this.findPreviousSmthIndex(e,a,f),r=document.createRange();r[s?"setEnd":"setStart"](a,o),i&&l(s);const m=this.getCaretPosN();if(m.node?.nodeValue===E&&(!i||a===this.lastNode)){const h=this.findPreviousSmthIndex(e,m.node,f);let p=!i;do{const c=this.getCaretPosN(),d=this.findPreviousSmthIndex(e,c.node,f);r[s?"setStart":"setEnd"](c.node,c.offset);const g=r.toString(),N=!W.test(g);if(this.log("test cursor",g,N,h,d),N&&c.node?.nodeValue===E&&d===h&&(d||c.offset)&&(d<f.length-1||c.offset<E.length))l(s),p=!0;else if(p){(!this.getFiller(a).classList.contains("input-filler-text")&&h!==u||c.offset===E.length)&&l(!s);break}else break}while(!0)}}restoreSavedRange(e){const t=this.getSavedRange(e);if(!t)return!1;const s=window.getSelection();return s.removeAllRanges(),s.addRange(t),!0}getSavedRange(e){return this.savedRanges.get(e)}makeFocused(e){document.activeElement!==e&&!this.restoreSavedRange(e)&&Q(e,!1,!1)}fixInsertedLineBreaks(e){e.querySelectorAll("br").forEach(t=>{t.classList.add("br-not-br")})}fixBuggedCaret(){const e=document.getSelection(),t=e.getRangeAt(0);e.removeAllRanges(),e.addRange(t)}addInputCallback(e,t,s=!0){const i=()=>{this.log("input modify callback"),t()};s&&oe?this.inputCaptureCallbacks.push(i):this.listenerSetter.add(e)("input",i,{once:!0,capture:s})}removeExtraBOMs(e){const t=s=>s?.classList?.contains("input-something");e.querySelectorAll(".input-filler").forEach(s=>{const{previousSibling:i,nextSibling:a}=s;let o=!1;!a?.classList?.contains("input-filler")&&ae(a)&&(o=t(i)||t(a)),o||(this.log.warn("removing empty bom node",s),s.remove())})}getFiller(e){return e&&e.nodeType===e.TEXT_NODE&&e.parentElement!==this.input?e.parentElement:e}getCaretPosN(){const e=Y(this.input);return{...e,move:this.move.bind(this,e.selection)}}removeEmptyTextNodes(e){const{log:t}=this,s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:a=>a.parentElement===e&&!a.nodeValue?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let i;for(;i=s.nextNode();)t.warn("removing empty text node",i),i.remove()}removePossibleBOMSiblings(e,t){[e,t].forEach(s=>{s?.classList?.contains("input-filler")&&s.remove()})}removePossibleBOMSiblingsByNode(e){const{previousSibling:t,nextSibling:s}=e;this.removePossibleBOMSiblings(t,s)}processEmptiedFillers(e){e.querySelectorAll(".input-filler-text").forEach(t=>{this.removeExtraBOMs(t);let s=!0;if(t.textContent)!W.test(t.textContent)&&!t.querySelector(".input-something")?t.classList.replace("input-filler-text","input-filler"):s=!1;else{t.classList.replace("input-filler-text","input-filler");const i=Array.from(t.childNodes).find(a=>a.nodeType===a.TEXT_NODE);i?i.insertData(0,E):t.t?.nodeValue?t.append(t.t):t.append(document.createTextNode(E))}s&&this.removePossibleBOMSiblingsByNode(t)})}processFilledFillers(e){e.querySelectorAll(".input-filler").forEach(t=>{if(t.textContent!==E){t.classList.replace("input-filler","input-filler-text");const s=t.t,i=Array.from(t.childNodes).find(a=>a.nodeType===a.TEXT_NODE&&a.nodeValue.includes(E));if(i&&!s?.nodeValue){const a=i.nodeValue.indexOf(E);a!==-1&&i.deleteData(a,E.length)}}})}setSelectionClassName(e,t){if(e.rangeCount){const s=e.getRangeAt(0);t?Array.from(t.querySelectorAll(".input-selectable")).forEach(i=>{i.classList.toggle("selection",!s.collapsed&&s.intersectsNode(i))}):Array.from(document.querySelectorAll(".input-selectable.selection")).forEach(i=>i.classList.remove("selection"))}}move(e,t){const{focusNode:s,focusOffset:i}=e;e.modify("extend",t?"backward":"forward","character"),t?e.collapseToStart():e.collapseToEnd();const{focusNode:a,focusOffset:o}=e;this.log("moving cursor",t,s,s.nodeType===s.ELEMENT_NODE?s:s.parentElement,i,a,a.nodeType===a.ELEMENT_NODE?a:a.parentElement,o)}prepareApplyingMarkdown(){const{input:e}=this,t=e.querySelectorAll(".input-filler"),s=e.querySelectorAll(".input-something");return s.forEach(i=>{i.contentEditable="inherit"}),()=>{t.forEach(i=>{i.contentEditable="inherit"}),s.forEach(i=>{i.contentEditable="false"}),this.removeExtraBOMs(e)}}static getInstance(){return this.INSTANCE??(this.INSTANCE=new _)}}function Ae(n){const e=document.createRange();e.selectNodeContents(n);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}const ke=new Set(["messageEntityPre","messageEntityCode"]);function Ie(n,e){let t=-1,s=-1;return n.find(i=>{const{offset:a,length:o}=i;return ke.has(i._)&&(t=a,s=t+o),t!==-1&&e.offset>=t&&e.offset<s&&!le.has(e._)?!0:e._===i._||!j.has(e._)&&!j.has(i._)?e.offset>=a&&e.length+e.offset<=o+a:!1})}function _e(n,e){n=n.slice();const t=e.filter(s=>!Ie(n,s));n.push(...t),K(n);for(let s=0;s<n.length;++s){let i=n[s];if(i._==="messageEntityEmoji"){const a=n[s+1];a&&a.offset<i.offset+i.length&&(i=n[s]={...i},i.length=a.offset-i.offset)}}return n}function J(n,e={}){if(!n)return F("");let t=e.entities;return t&&!V.premium&&e.wrappingForPeerId!==V.myId&&(t=t.filter(i=>i._!=="messageEntityCustomEmoji")),F(n,{...e,entities:t,noLinks:!0,wrappingDraft:!0,passEntities:{messageEntityTextUrl:!0,messageEntityMentionName:!0}})}async function Re(n,e,t,s){const i=[],o=t?.some(h=>h._==="messageEntityCustomEmoji")?Z():void 0,l=J(e,{entities:t,wrappingForPeerId:s,loadPromises:i,customEmojiRenderer:o});l.querySelectorAll('[contenteditable="false"]').forEach(h=>{h.contentEditable="inherit",h.classList.add("pc")}),i.length&&await Promise.all(i),l.querySelectorAll(".input-selectable").forEach(h=>{h.prepend(me(!0))});const u=Array.from(l.querySelectorAll(".custom-emoji-placeholder")).map(h=>(h.dataset.ces="1",h.customEmojiElement)),r=ye(l);o?.destroy();const m=Y(n);if(!m.node){const h=document.createRange();let p=n.lastChild;p||n.append(p=document.createTextNode("")),h.setStartAfter(p),h.collapse(!0),m.selection.removeAllRanges(),m.selection.addRange(h)}n.addEventListener("input",ge,{capture:!0,once:!0,passive:!1}),window.document.execCommand("insertHTML",!1,r),Array.from(n.querySelectorAll("[data-ces]")).forEach((h,p)=>{delete h.dataset.ces;const c=u[p];h.customEmojiElement=c,c.placeholder=h}),n.querySelectorAll(".pc").forEach(h=>{h.contentEditable="false"}),$(n,"input")}let I=()=>{document.addEventListener("paste",n=>{const e=Ne(n.target,'contenteditable="true"');if(!e)return;const t=!!e.dataset.noLinebreaks;n.preventDefault();let s,i,a=(n.originalEvent||n).clipboardData.getData("text/plain"),o=!0,l=(n.originalEvent||n).clipboardData.getData("text/html")||a;const f=r=>r._==="messageEntityEmoji"||r._==="messageEntityLinebreak"&&!t;if(t){const r=/[\r\n]/g;a=a.replace(r,""),l=l.replace(r,"")}const u=(e.dataset.peerId||he).toPeerId();if(l.trim()){l=l.replace(/<style([\s\S]*)<\/style>/,""),l=l.replace(/<!--([\s\S]*)-->/,""),l=l.replace('<br class="Apple-interchange-newline">',"");const r=l.match(/<body>([\s\S]*)<\/body>/);r&&(l=r[1].trim());const p=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body");let c=p.firstChild;for(;c;){const y=c.nextSibling;c.nodeType===c.TEXT_NODE&&(c.nodeValue.trim()||c.remove()),c=y}const d=L(p,!0,!1);!!u||(d.entities=d.entities.filter(y=>y._!=="messageEntityCustomEmoji"));{const y=d.value.split(`
`);let C=0;for(let v=0;v<y.length;++v){const R=y[v];C+=R.length;const M=C;if(a[M]!==`
`&&v!==y.length-1){const B=y.splice(v+1,1)[0];y[v]=R+B,d.entities.forEach(P=>{P.offset>=M&&(P.offset-=1)}),C+=B.length}C+=1}const T=y.join(`
`);d.value=T}const N=d.value.replace(/\s/g,"").length,b=a.replace(/\s/g,"").length;if(N===b||d.entities.find(y=>y._==="messageEntityCustomEmoji")){s=d.value,i=d.entities,o=!1;let y=q(s);y=y.filter(f),i=_e(i,y)}}o&&(s=a,i=q(s),i=i.filter(f)),Re(e,s,i,u)}),I=null};var Me=(n=>(n[n.Neutral=0]="Neutral",n[n.Valid=1]="Valid",n[n.Error=2]="Error",n))(Me||{});function Z(n,e){return pe.create({wrappingDraft:!0,isSelectable:!0,textColor:n||"primary-text-color",animationGroup:e})}function X(n){const e=Array.from(n.querySelectorAll(".custom-emoji, .custom-emoji-placeholder"));let t=n.querySelector(".custom-emoji-renderer");if(!t&&e.length)t=Z(n.dataset.textColor,n.dataset.animationGroup),n.prepend(t);else if(t&&!e.length){t.remove();return}if(!t)return;const s=new Map;e.forEach(i=>{const a=i.loop!==void 0?i:i.customEmojiElement,{docId:o}=a;let l=s.get(o);l||s.set(o,l=new Set),l.add(a)});for(const[i,a]of s){let o=t.customEmojis.get(i);if(o)for(const l of o)a.has(l)||l.destroy();else o=new Set;for(const l of a)o.has(l)||l.connectedCallback()}t.add({addCustomEmojis:s,lazyLoadQueue:!1}),t.forceRender()}class je{constructor(e={}){this.options=e,this.setEmpty=(g=this.isEmpty())=>{[this.input,this.placeholder].filter(Boolean).forEach(N=>{N.classList.toggle("is-empty",g)})},this.container=document.createElement("div"),this.container.classList.add("input-field"),this.required=e.required,this.validate=e.validate,e.maxLength!==void 0&&e.showLengthOn===void 0&&(e.showLengthOn=Math.min(40,Math.round(e.maxLength/3)));const{placeholder:t,maxLength:s,showLengthOn:i,name:a,plainText:o,canBeEdited:l=!0,autocomplete:f,withBorder:u,allowStartingSpace:r,canHaveFormatting:m}=e,h=e.label||e.labelText;this.allowStartingSpace=r;const p=[];let c;if(o?(this.container.innerHTML=`
      <input type="text" ${a?`name="${a}"`:""} autocomplete="${f??"off"}" ${h?'required=""':""} class="input-field-input">
      `,c=this.container.firstElementChild,p.push(()=>{const g=this.isEmpty();g&&(c.value=""),this.setEmpty(g)})):(I&&I(),this.container.innerHTML='<div class="input-field-input"></div>',c=this.container.firstElementChild,c.contentEditable=""+!!l,_.getInstance(),c.addEventListener("mousedown",g=>{const N=document.getSelection();if(!N.isCollapsed)return;const b=ve(g.target,"IMG");if(!b)return;const y=b.getBoundingClientRect(),C=y.left+y.width/2,T=g.clientX>=C,v=document.createRange();v.setStartAfter(T?b:b.previousSibling??b),N.removeAllRanges(),N.addRange(v)}),m&&c.setAttribute("can-format",m.join(",")),p.push(()=>{const g=this.isEmpty();g&&c.replaceChildren(),this.setEmpty(g),ue(Array.from(c.querySelectorAll(".input-something"))),X(c)})),re(c),e.inputMode&&(c.inputMode=e.inputMode),t&&(this.placeholder=document.createElement("span"),this.placeholder.classList.add("input-field-placeholder"),this.container.append(this.placeholder),ce(this.placeholder,t,void 0)),u!==!1&&u||h||t){const g=document.createElement("div");g.classList.add("input-field-border"),this.container.append(g)}if(h&&(this.label=document.createElement("label"),this.setLabel(),this.container.append(this.label)),s){const g=this.container.lastElementChild;let N=!1;const b=()=>{const y=c.classList.contains("error"),C=o?c.value.length:[...L(c,!1,!1).value].length,T=s-C,v=T<0;c.classList.toggle("error",v),v||T<=i?(this.setLabel(),g.append(` (${s-C})`),N||(N=!0)):(y&&!v||N)&&(this.setLabel(),N=!1)};p.push(b)}!e.withLinebreaks&&!o&&(c.dataset.noLinebreaks="1",c.addEventListener("keypress",g=>{if(g.key==="Enter")return g.preventDefault(),!1})),e.onRawInput&&p.push(()=>{e.onRawInput(this.value)}),p.length&&c.addEventListener("input",()=>{p.forEach(g=>g())}),this.input=c,this.setEmpty(!0)}select(){this.value&&(this.options.plainText?this.input.select():Ae(this.input))}setLabel(){this.label.textContent="",this.options.labelText?de(this.label,this.options.labelText):this.label.append(D(this.options.label,this.options.labelOptions))}get value(){return this.options.plainText?this.input.value:L(this.input,!1,!1).value}set value(e){this.setValueSilently(e,!0),this.simulateInputEvent()}simulateInputEvent(){$(this.input,"input")}setValueSilently(e,t){this.options.plainText?this.input.value=e:(fe(this.input,e),X(this.input)),this.setEmpty()}isEmpty(){return we(this.input,this.allowStartingSpace)}isChanged(){return this.value!==this.originalValue}isValid(){return!this.input.classList.contains("error")&&(!this.validate||this.validate())&&(!this.required||!this.isEmpty())}isValidToChange(){return this.isValid()&&this.isChanged()}setDraftValue(e="",t){let s=e;this.options.plainText||(s=J(e)),t?this.setValueSilently(s,!1):this.value=s}setOriginalValue(e="",t){this.originalValue=e,this.setDraftValue(e,t)}setState(e,t){t?(this.label.textContent="",this.label.append(D(t,this.options.labelOptions))):this.setLabel(),this.input.classList.toggle("error",!!(e&2)),this.input.classList.toggle("valid",!!(e&1))}setError(e){this.setState(2,e)}}export{je as I,Oe as L,_ as R,Me as a,ve as b,L as c,ye as d,Se as e,Ne as f,be as g,Ie as h,we as i,O as j,Re as k,_e as m,Q as p,K as s,Ee as t,J as w};
//# sourceMappingURL=inputField-BaOnrCSn.js.map
